<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KRA + Salary + Incentive + TDS Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--bg:#0f172a;--card:#020617;--accent:#38bdf8;--green:#22c55e;--red:#ef4444;--text:#e5e7eb}
*{box-sizing:border-box}
body{margin:0;padding:18px;font-family:Arial,system-ui;background:var(--bg);color:var(--text)}
.wrap{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:18px}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
h2,h3{margin:0 0 10px}
label{font-size:13px;margin-top:8px;display:block;color:#cbd5f5}
input,select,button{padding:9px;border-radius:8px;border:1px solid #334155;background:#020617;color:#e5e7eb;font-size:14px}
button{background:var(--accent);border:none;color:#020617;font-weight:600;cursor:pointer}
button.secondary{background:#475569;color:#fff}
.row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
.result{margin-top:10px;font-weight:bold}
.muted{font-size:13px;color:#94a3b8}

.table-wrapper{
  max-height:320px;
  overflow-y:auto;
  margin-top:12px;
  border:1px solid #334155;
  border-radius:8px;
}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;text-align:center;border-bottom:1px solid #334155;font-size:14px}
thead th{position:sticky;top:0;background:#020617;z-index:2}

@media(max-width:900px){.wrap{grid-template-columns:1fr}}
</style>
</head>

<body>

<div class="wrap">

<!-- ================= CALCULATOR ================= -->
<section class="card">
<h2>Talk Time & KRA Calculator</h2>

<button id="toggleBtn" onclick="toggleMode()">Switch to Manual Talk Time</button>

<div id="autoMode">
  <label>Calls Handled</label>
  <input id="calls" type="number">

  <div class="row">
    <div>
      <label>Avg Talk Time (Minutes)</label>
      <input id="minutes" type="number">
    </div>
    <div>
      <label>Avg Talk Time (Seconds)</label>
      <input id="seconds" type="number" max="59">
    </div>
  </div>
</div>

<div id="manualMode" style="display:none">
  <label>Total Talk Time (Minutes)</label>
  <input id="manualTT" type="number" step="0.01">
</div>

<label>Effective CC</label>
<input id="effCC" type="number">

<button style="margin-top:10px" onclick="calculateKRA()">Calculate KRA</button>
<div class="result" id="kraResult">KRA: —</div>

<hr>

<label>Add Calculated KRA to Employee</label>
<select id="employeeSelect"></select>
<input type="date" id="kraDate">
<button onclick="addCalculated()">Add to Dashboard</button>
</section>

<!-- ================= DASHBOARD ================= -->
<section class="card">
<h2>Salary + Incentive Dashboard</h2>

<label>Select Employee</label>
<select id="employeeName" onchange="renderTable()"></select>

<div class="row">
  <input id="newEmployeeName" placeholder="New Employee Name">
  <button class="secondary" onclick="addNewEmployee()">Add Employee</button>
</div>

<label>Salary Cycle</label>
<select id="cycleSelect" onchange="renderTable()">
  <option value="current">Current Cycle (11–10)</option>
  <option value="previous">Previous Cycle (11–10)</option>
</select>

<hr>

<h3>Incentive (3% on Sale)</h3>
<div class="row">
  <input id="saleInput" type="number" placeholder="Total Sale ₹">
  <button onclick="addIncentive()">Add Incentive</button>
</div>
<div id="incInfo" class="muted"></div>

<h3 style="margin-top:10px">Add KRA Manually</h3>
<div class="row">
  <input type="date" id="manualKraDate">
  <input type="number" id="manualKraPercent" placeholder="KRA %">
  <button onclick="addKRAManual()">Add Entry</button>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr><th>Date</th><th>KRA%</th><th>Salary</th><th>Actions</th></tr>
</thead>
<tbody id="kraTableBody"></tbody>
</table>
</div>

<div class="result" id="totalSalary"></div>
<div class="muted">* Salary cycle: 11th to 10th | 10% TDS deducted</div>
</section>

</div>

<script>
let data = JSON.parse(localStorage.getItem("kraData")||"[]");
let employees = JSON.parse(localStorage.getItem("kraEmployees")||'["Ritik","Abhishek","Vipul"]');
let incentives = JSON.parse(localStorage.getItem("kraIncentives")||"{}");

let manualMode=false,lastKRA=null;

function populateEmployees(){
  employeeName.innerHTML=employeeSelect.innerHTML="";
  employees.forEach(e=>{
    employeeName.innerHTML+=`<option>${e}</option>`;
    employeeSelect.innerHTML+=`<option>${e}</option>`;
  });
}
populateEmployees();renderTable();

function toggleMode(){
  manualMode=!manualMode;
  autoMode.style.display=manualMode?"none":"block";
  manualMode.style.display=manualMode?"block":"none";
  toggleBtn.innerText=manualMode?"Switch to Auto Talk Time":"Switch to Manual Talk Time";
}

function calculateKRA(){
  const cc=+effCC.value;if(!cc){alert("Enter Effective CC");return;}
  let totalMinutes=0;
  if(manualMode){
    totalMinutes=+manualTT.value;if(!totalMinutes){alert("Enter talk time");return;}
  }else{
    const c=+calls.value,m=+minutes.value||0,s=+seconds.value||0;
    if(!c){alert("Enter calls");return;}
    totalMinutes=c*((m*60+s)/60);
  }
  const kra=((cc/50)*0.5+(totalMinutes/240)*0.5)*100;
  lastKRA=+kra.toFixed(2);
  kraResult.innerText="KRA: "+lastKRA+"%";
}

function salaryFromKRA(k){
  if(k>=150)return 1100;
  if(k>=135)return 1000;
  if(k>=120)return 900;
  if(k>=100)return 750;
  if(k>=80)return 500;
  if(k>=60)return 300;
  return 0;
}

function addCalculated(){
  if(lastKRA===null)return alert("Calculate KRA first");
  const name=employeeSelect.value;
  const date=kraDate.value||new Date().toISOString().slice(0,10);
  if(data.some(d=>d.name===name&&d.date===date))return alert("Entry exists");
  data.push({name,date,kra:lastKRA,salary:salaryFromKRA(lastKRA)});
  save();renderTable();
}

function addKRAManual(){
  const name=employeeName.value;
  const date=manualKraDate.value;
  const kra=parseFloat(manualKraPercent.value);
  if(!date||isNaN(kra))return alert("Invalid input");
  if(data.some(d=>d.name===name&&d.date===date))return alert("Entry exists");
  data.push({name,date,kra,salary:salaryFromKRA(kra)});
  manualKraDate.value=manualKraPercent.value="";
  save();renderTable();
}

function addIncentive(){
  const sale=+saleInput.value;if(!sale)return alert("Enter sale");
  incentives[employeeName.value]=+(sale*0.03).toFixed(2);
  save();renderTable();
}

function addNewEmployee(){
  const n=newEmployeeName.value.trim();
  if(!n||employees.includes(n))return alert("Invalid / Exists");
  employees.push(n);save();populateEmployees();
  employeeName.value=employeeSelect.value=n;
  newEmployeeName.value="";
}

function getCycleRange(type){
  const t=new Date();let start,end;
  if(type==="previous"){
    start=new Date(t.getFullYear(),t.getMonth()-1,11);
    end=new Date(t.getFullYear(),t.getMonth(),10);
  }else{
    if(t.getDate()>=11){
      start=new Date(t.getFullYear(),t.getMonth(),11);
      end=new Date(t.getFullYear(),t.getMonth()+1,10);
    }else{
      start=new Date(t.getFullYear(),t.getMonth()-1,11);
      end=new Date(t.getFullYear(),t.getMonth(),10);
    }
  }
  return {start,end};
}

function renderTable(){
  const emp=employeeName.value;
  const cycle=document.getElementById("cycleSelect").value;
  const {start,end}=getCycleRange(cycle);

  kraTableBody.innerHTML="";
  let salary=0,days=new Set();

  data.filter(d=>{
    if(d.name!==emp)return false;
    const dt=new Date(d.date);
    return dt>=start&&dt<=end;
  }).forEach(d=>{
    salary+=d.salary;days.add(d.date);
    kraTableBody.innerHTML+=`
      <tr>
        <td>${d.date}</td>
        <td>${d.kra}</td>
        <td>₹${d.salary}</td>
        <td>
          <button onclick="editRow('${d.name}','${d.date}')">Edit</button>
          <button onclick="del('${d.name}','${d.date}')">Delete</button>
        </td>
      </tr>`;
  });

  const inc=incentives[emp]||0;
  const gross=salary+inc;
  const tds=(gross*0.10).toFixed(2);
  const net=(gross-tds).toFixed(2);

  totalSalary.innerHTML=`
    Working Days: ${days.size}<br>
    Salary: ₹${salary}<br>
    Incentive: ₹${inc}<br><br>
    <b>Total (Before TDS): ₹${gross}</b><br>
    <span style="color:var(--red)">TDS (10%): -₹${tds}</span><br>
    <span style="color:var(--green)">Net Pay: ₹${net}</span>
  `;
  incInfo.innerText=inc?`Incentive Added: ₹${inc}`:"No incentive added";
}

function del(n,d){data=data.filter(x=>!(x.name===n&&x.date===d));save();renderTable();}
function editRow(n,d){
  const i=data.find(x=>x.name===n&&x.date===d);
  if(!i)return;
  employeeName.value=employeeSelect.value=n;
  kraDate.value=d;lastKRA=i.kra;
  kraResult.innerText="KRA: "+lastKRA+"%";
  del(n,d);
}

function save(){
  localStorage.setItem("kraData",JSON.stringify(data));
  localStorage.setItem("kraEmployees",JSON.stringify(employees));
  localStorage.setItem("kraIncentives",JSON.stringify(incentives));
}
</script>

</body>
</html>